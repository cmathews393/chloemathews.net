name: Generate resume PDF

on:
    push:
        branches: [main]
        # avoid re-running this workflow when the generated PDF is the only change
        paths-ignore:
            - "public/resume.pdf"
    workflow_dispatch: {}

concurrency:
    group: generate-resume
    cancel-in-progress: true

permissions:
    contents: write

jobs:
    generate:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0
                  persist-credentials: true

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"

            - name: Install LaTeX dependencies
              run: |
                  sudo apt-get update
                  # install a minimal texlive set that includes pdflatex + common packages used in the resume template
                  sudo apt-get install -y texlive-latex-base texlive-latex-recommended texlive-latex-extra texlive-fonts-recommended

            - name: Install npm dependencies
              run: |
                  # prefer a fast, reproducible install; fall back to npm install when package-lock is absent
                  npm ci --prefer-offline --no-audit || npm install --no-audit

            - name: Generate PDF
              run: npm run generate:resume

            - name: Show output (for debugging)
              run: |
                  if [ -f public/resume.pdf ]; then ls -l public/resume.pdf; else echo "resume.pdf not generated"; fi
